{"version":3,"sources":["../src/restore.js"],"names":["define","$","config","session","session_key","total_records","current","record","restore_courses","course_table","data","record_rows","length","attr","html","removeClass","restore_course","record_row","categoryId","folder","filename","name","shortname","idnumber","restore_users","restore_blocks","$url","wwwroot","addClass","ajax","type","url","dataType","success","currentProgress","Math","floor","message","status","hide","result","error","window","console","log","init","on"],"mappings":"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","sourcesContent":["define(['jquery', 'core/config'], function($, config) {\n\n  var session = '';\n  var session_key = '';\n  var total_records = 0;\n  var current = 0;\n  var record = 0;\n\n  var restore_users = 0;\n  var restore_blocks = 0;\n\n  var restore_courses = function() {\n\n    var course_table = $('#restore-table');\n\n    session = course_table.data('session');\n    session_key = course_table.data('key');\n\n    var record_rows = $('.record-row');\n\n    total_records = record_rows.length;\n\n    $('.progress-bar').attr('aria-valuenow', 0);\n    $('.progress-bar').attr('style', 'width: 0');\n    $('.progress-bar').html('0%');\n\n    $('.progress').removeClass('d-none');\n\n    if (total_records > 0) {\n      current = 1;\n      restore_course();\n    }\n  };\n\n  var restore_course = function() {\n\n    record = current;\n\n    var record_row = $('#record-' + record);\n\n    var categoryId = record_row.data('category');\n    var folder = record_row.data('folder');\n    var filename = record_row.data('filename');\n    var name = record_row.data('name');\n    var shortname = record_row.data('shortname');\n    var idnumber = record_row.data('idnumber');\n    var restore_users = record_row.data('users');\n    var restore_blocks = record_row.data('blocks');\n\n    if (record > 0 && record <= total_records) {\n\n      var $url = config.wwwroot + '/admin/tool/bulk_backupandrestore/restore_course.php';\n      record_row.addClass('text-primary');\n      record_row.addClass('border-primary');\n\n      $('#record-' + record + ' > td.status').html('');\n\n      $.ajax({\n        type: \"POST\",\n        url:$url,\n        dataType: 'json',\n        data: {\n          'sesskey': session,\n          'key': session_key,\n          'category': categoryId,\n          'folder': folder,\n          'filename': filename,\n          'name': name,\n          'shortname': shortname,\n          'idnumber': idnumber,\n          'restoreusers': restore_users,\n          'restoreblocks': restore_blocks,\n          'last': (record == total_records)?true:false\n        },\n        success: function(data) {\n          record_row.removeClass('border-primary');\n          record_row.removeClass('text-danger');\n          record_row.removeClass('text-primary');\n\n          var currentProgress = Math.floor((current / total_records) * 100);\n          $('.progress-bar').attr('aria-valuenow', currentProgress);\n          $('.progress-bar').attr('style', 'width: ' + currentProgress + '%');\n          $('.progress-bar').html(currentProgress + '%');\n          $('#record-' + record + ' > td.status').html(data.message);\n\n          if (data.status == true) {\n            record_row.addClass('text-success');\n          }else {\n            record_row.addClass('text-danger');\n          }\n           \n          if (record < total_records) {\n            current++;\n            restore_course();\n          }else {\n            $('.progress').hide();\n            $('.result').html(data.result);\n          }\n        },\n        error: function() {\n          window.console.log('Error on record ' + record);\n          record_row.removeClass('border-primary');\n          record_row.removeClass('text-success');\n          record_row.removeClass('text-primary');\n          record_row.addClass('text-danger');\n\n          var currentProgress = Math.floor((current / total_records) * 100);\n          $('.progress-bar').attr('aria-valuenow', currentProgress);\n          $('.progress-bar').attr('style', 'width: ' + currentProgress + '%');\n          $('.progress-bar').html(currentProgress + '%');\n\n          if (record <= total_records) {\n            current++;\n            restore_course();\n          }else {\n            $('.progress').hide();\n          }\n        }\n      });\n    }\n  };\n\n\n  return  {\n    init: function() {\n      $('#restore_courses').on('click', function() {\n        restore_courses();\n      });\n    },\n  };\n});\n"],"file":"restore.min.js"}