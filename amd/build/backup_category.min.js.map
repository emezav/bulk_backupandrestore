{"version":3,"sources":["../src/backup_category.js"],"names":["define","$","config","session","session_key","outdir","total_courses","current","record","backup_users","backup_blocks","backup_category","course_table","data","course_rows","length","attr","html","removeClass","backup_course","courseId","$url","wwwroot","addClass","ajax","type","url","dataType","success","currentProgress","Math","floor","message","status","hide","result","error","init","on"],"mappings":"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","sourcesContent":["define(['jquery', 'core/config'], function($, config) {\n\n  var session = '';\n  var session_key = '';\n  var outdir = '';\n  var total_courses = 0;\n  var current = 0;\n  var record = 0;\n\n  var backup_users = 0;\n  var backup_blocks = 0;\n\n  var backup_category = function() {\n\n    var course_table = $('#course-table');\n\n    session = course_table.data('session');\n    session_key = course_table.data('key');\n    outdir = course_table.data('outdir');\n    backup_users = course_table.data('backupusers');\n    backup_blocks = course_table.data('backupblocks');\n\n    var course_rows = $('.course-row');\n\n    total_courses = course_rows.length;\n\n    $('.progress-bar').attr('aria-valuenow', 0);\n    $('.progress-bar').attr('style', 'width: 0');\n    $('.progress-bar').html('0%');\n\n    $('.progress').removeClass('d-none');\n\n    if (total_courses > 0) {\n      current = 1;\n      backup_course();\n    }\n  };\n\n  var backup_course = function() {\n\n    record = current;\n\n    var courseId = $('.course-row-' + record).data('course');\n\n    if (record > 0 && record <= total_courses) {\n\n      var $url = config.wwwroot + '/admin/tool/bulk_backupandrestore/backup_course.php';\n      $('#course-' + courseId).addClass('text-primary');\n      $('#course-' + courseId).addClass('border-primary');\n\n\n      $('#course-' + courseId + ' > td.status').html('');\n\n      $.ajax({\n        type: \"POST\",\n        url:$url,\n        dataType: 'json',\n        data: {\n          'id': courseId,\n          'sesskey': session,\n          'key': session_key,\n          'outdir' : outdir,\n          'backupusers' : backup_users,\n          'backupblocks' : backup_blocks,\n          'last' : (record == total_courses)?true:false\n        },\n        success: function(data) {\n          $('#course-' + courseId).removeClass('border-primary');\n          $('#course-' + courseId).removeClass('text-primary');\n\n          var currentProgress = Math.floor((current / total_courses) * 100);\n          $('.progress-bar').attr('aria-valuenow', currentProgress);\n          $('.progress-bar').attr('style', 'width: ' + currentProgress + '%');\n          $('.progress-bar').html(currentProgress + '%');\n          $('#course-' + courseId + ' > td.status').html(data.message);\n\n          if (data.status == true) {\n            $('#course-' + courseId).addClass('text-success');\n          }else {\n            $('#course-' + courseId).addClass('text-danger');\n          }\n           \n          if (record < total_courses) {\n            current++;\n            backup_course();\n          }else {\n            $('.progress').hide();\n            $('.result').html(data.result);\n          }\n        },\n        error: function() {\n          $('#course-' + courseId).removeClass('border-primary');\n          $('#course-' + courseId).removeClass('text-primary');\n          $('#course-' + courseId).addClass('text-danger');\n\n          var currentProgress = Math.floor((current / total_courses) * 100);\n          $('.progress-bar').attr('aria-valuenow', currentProgress);\n          $('.progress-bar').attr('style', 'width: ' + currentProgress + '%');\n          $('.progress-bar').html(currentProgress + '%');\n\n          if (record <= total_courses) {\n            current++;\n            backup_course();\n          }else {\n            $('.progress').hide();\n          }\n        }\n      });\n    }\n  };\n\n\n  return  {\n    init: function() {\n      $('#backup_category').on('click', function() {\n        backup_category();\n      });\n    },\n  };\n});\n"],"file":"backup_category.min.js"}